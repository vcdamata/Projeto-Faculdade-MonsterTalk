<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../styles/header.css" />
    <link rel="stylesheet" href="../styles/sidebar.css" />
    <link rel="stylesheet" href="../styles/dashboard_professor.css" />
    <link rel="stylesheet" href="../styles/dashboard_professor_alunos.css" />
    <link rel="stylesheet" href="../styles/editar_aluno_form.css" />
    <link rel="shortcut icon" type="imagex/svg" href="../img/mascote.svg" />
    <title>Editar Aluno - MonsterTalk</title>
  </head>
  <body>
    <header class="topbar">
      <h2 class="saldacao">Olá, Professor</h2>
      <a href="#" class="avatar-link">
        <img src="../img/avatar.png" alt="Avatar do professor" class="avatar" />
      </a>
    </header>

    <aside class="sidebar">
      <div class="sidebar-header">
        <a href="#">
          <img
            src="../img/logo_horizontal.svg"
            alt="Logo MonsterTalk"
            class="logo_horizontal"
          />
        </a>
      </div>
      <nav>
        <ul>
          <li>
            <a href="#">
              <img src="../img/icon_painel.svg" alt="icone painel professor" class="icon_menu" /> Painel
            </a>
          </li>
          <li>
            <a href="#">
              <img src="../img/icon_classe.svg" alt="icone classes" class="icon_menu" /> Classes
            </a>
          </li>
          <li class="active">
            <a href="#">
              <img src="../img/icon_alunos.svg" alt="icone Alunos" class="icon_menu" /> Alunos
            </a>
          </li>
          <li>
            <a href="#">
              <img src="../img/icon_curriculo.svg" alt="icone Currículo" class="icon_menu" /> Currículo
            </a>
          </li>
          <li>
            <a href="#">
              <img src="../img/icon_licoes.svg" alt="icone Lições" class="icon_menu" /> Criar Lições
            </a>
          </li>
          <li>
            <a href="#">
              <img src="../img/icon_forum.svg" alt="icone Fórum" class="icon_menu" /> Fórum
            </a>
          </li>
        </ul>
      </nav>
      <button class="hamburger" aria-label="Abrir menu" aria-expanded="false">&#9776;</button>
    </aside>

    <main class="painel">
      <header class="top-bar">
        <h1>Painel do<br />Professor</h1>
        <div class="cabecalho-alunos-contexto">
          <h2>Administrar Alunos</h2>
        </div>
      </header>

      <section class="editar-aluno-container">
        <h3 class="titulo-editar-aluno">Editar Aluno</h3>

        <div class="info-aluno-selecionado">
          <span class="label-info">Aluno Selecionado:</span>
          <span class="nome-aluno-display" id="nomeAlunoDisplay">Carregando...</span>
        </div>

        <div class="form-trocar-classe">
          <label for="select-turma" class="label-info">Trocar Classe:</label>
          <select id="select-turma" name="turma" class="select-turma-estilizado">
            <option value="turma_do_barulho">Turma do Barulho</option>
            <option value="english_monsters">English Monsters</option>
            <option value="outra_turma">Outra Turma</option>
          </select>
        </div>

        <div class="secao-confirmacao">
          <p class="texto-confirmacao">Deseja Salvar?</p>
          <div class="grupo-botoes-confirmacao">
            <button type="button" class="btn-acao btn-nao" id="btnNaoSalvar">Não</button>
            <button type="button" class="btn-acao btn-sim" id="btnSimSalvar">Sim</button>
          </div>
        </div>
      </section>
    </main>

    <script>
      function obterParametroUrl(nome) {
        nome = nome.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + nome + '=([^&#]*)');
        var resultados = regex.exec(location.search);
        return resultados === null ? '' : decodeURIComponent(resultados[1].replace(/\+/g, ' '));
      }

      document.addEventListener('DOMContentLoaded', function() {
        const nomeAlunoOriginal = obterParametroUrl('nome');
        const turmaAlunoOriginal = obterParametroUrl('turma');

        const nomeAlunoDisplayElement = document.getElementById('nomeAlunoDisplay');
        const selectTurmaElement = document.getElementById('select-turma');
        const btnSimSalvar = document.getElementById('btnSimSalvar');
        const btnNaoSalvar = document.getElementById('btnNaoSalvar');

        if (nomeAlunoOriginal && nomeAlunoDisplayElement) {
          nomeAlunoDisplayElement.textContent = nomeAlunoOriginal;
        } else if (nomeAlunoDisplayElement) {
          nomeAlunoDisplayElement.textContent = 'Nome não encontrado';
        }

        if (turmaAlunoOriginal && selectTurmaElement) {
          let optionEncontrada = false;
          for (let i = 0; i < selectTurmaElement.options.length; i++) {
            if (selectTurmaElement.options[i].value === turmaAlunoOriginal) {
              selectTurmaElement.value = turmaAlunoOriginal;
              optionEncontrada = true;
              break;
            }
          }
          if (!optionEncontrada) {
            for (let i = 0; i < selectTurmaElement.options.length; i++) {
                if (selectTurmaElement.options[i].text.toLowerCase() === turmaAlunoOriginal.toLowerCase().replace(/_/g, ' ')) {
                    selectTurmaElement.value = selectTurmaElement.options[i].value;
                    break;
                }
            }
          }
        }

        if (btnSimSalvar) {
            btnSimSalvar.addEventListener('click', function() {
                const novaTurmaSelecionada = selectTurmaElement.options[selectTurmaElement.selectedIndex].text;

                if (nomeAlunoOriginal && novaTurmaSelecionada) {
                    let studentUpdates = JSON.parse(localStorage.getItem('studentUpdates')) || {};
                    studentUpdates[nomeAlunoOriginal] = novaTurmaSelecionada;
                    localStorage.setItem('studentUpdates', JSON.stringify(studentUpdates));
                }
                window.location.href = '../dashboard_professor_alunos/alunos.html';
            });
        }

        if (btnNaoSalvar) {
            btnNaoSalvar.addEventListener('click', function() {
                window.location.href = '../dashboard_professor_alunos/alunos.html';
            });
        }
      });

      const hamburger = document.querySelector(".hamburger");
      const sidebar = document.querySelector(".sidebar");

      if (hamburger && sidebar) {
        hamburger.addEventListener("click", () => {
          const isActive = sidebar.classList.toggle("active");
          hamburger.setAttribute("aria-expanded", isActive);
        });
      }
    </script>
  </body>
</html>